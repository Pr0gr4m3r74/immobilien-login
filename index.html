<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login – Geschützter Bereich</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="box">
  <h2>Willkommen bei Immobilien Login</h2>
  <p>Als Kunde sehen Sie mit Passwort sofort die verfügbaren Wohnungen. Admins verwalten Angebote über die separate Anmeldung.</p>
  <label for="pw" class="sr-only">Kundenpasswort</label>
  <input type="password" id="pw" placeholder="Kunden-Passwort eingeben">
  <div class="action-row">
    <button onclick="login('customer')">Kunden Login</button>
    <button class="secondary" onclick="login('admin')">Admin Anmeldung</button>
  </div>
  <p class="hint center">Admins nutzen ihr Admin-Passwort und erhalten die Bearbeitungssicht.</p>
  <p id="msg" class="error"></p>
</div>
<script>
// Password is stored as SHA-256 hash (hashed value of "1234Test")
// This prevents the password from being visible in plain text
const PASS_HASH = "0d214e3d94bb80f70deffda9bd7a530fb8369e4d6e0586e13348eb4cfa7d9a52";
// Admin password hash of "Admin123!"
const ADMIN_HASH = "3eb3fe66b31e3b4d10fa70b5cad49c7112294af6ae4e476a1c405155d45aa121";
const COOLDOWN = 1000;
let lastTry = 0;

// SHA-256 hashing function
async function hashPassword(password) {
    const msgBuffer = new TextEncoder().encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    return hashHex;
}

function setSession(role) {
    sessionStorage.setItem("access", Date.now());
    sessionStorage.setItem("role", role);
    window.location.href = "geheim.html";
}

async function login(role = "customer") {
    const now = Date.now();
    if (now - lastTry < COOLDOWN) {
        document.getElementById("msg").textContent = "Bitte 1 Sekunde warten...";
        return;
    }
    lastTry = now;
    const val = document.getElementById("pw").value.trim();
    if (!val) {
        document.getElementById("msg").textContent = "Bitte Passwort eingeben.";
        return;
    }
    const hashedInput = await hashPassword(val);
    const target = role === "admin" ? ADMIN_HASH : PASS_HASH;
    
    if (hashedInput === target) {
        setSession(role);
    } else {
        document.getElementById("msg").textContent = "Falsches Passwort";
    }
}

document.getElementById("pw").addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    login("customer");
  }
});
</script>
</body>
</html>
